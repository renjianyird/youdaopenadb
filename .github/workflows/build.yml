name: 自动构建并发布 Release

# 只要你 push 代码，就自动编译发版
on:
  push:
    branches:
      - main
  workflow_dispatch:

permissions:
  contents: write

jobs:
  build:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4

      - name: 设置 Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: 安装依赖
        run: |
          pip install --upgrade pip
          pip install requests pyinstaller

      - name: 编译 EXE
        run: pyinstaller -F -c YoudaoADB_FullAuto.py

      - name: 自动生成版本号 2.0 → 2.1 → 2.2…
        id: version
        shell: pwsh
        run: |
          $base = 2.0
          $build = $env:GITHUB_RUN_NUMBER
          $ver = [math]::Round($base + $build/10, 1)
          echo "build_version=$ver" >> $env:GITHUB_OUTPUT

      - name: 发布到 Release
        uses: softprops/action-gh-release@v2
        with:
          tag_name: v${{ steps.version.outputs.build_version }}
          name: 有道词典笔ADB工具 v${{ steps.version.outputs.build_version }}
          body: |
            ✅ 自动构建版本：v${{ steps.version.outputs.build_version }}
            ✅ 作者：喂鸡 (Wei Ji)
            ✅ 全流程一体化工具
            © 2026 喂鸡 (Wei Ji) 版权所有
          files: dist/YoudaoADB_FullAuto.exe
